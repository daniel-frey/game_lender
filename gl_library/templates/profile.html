{% extends 'base/base.html' %}

{% block content %}
<div id="page-content" class="index-page container">
  <div class="row">
    <div class="col-md-6 col-md-offset-1">
      <div id="main-content">
        <h2>Your Profile</h2>
        {% if messages %}
        <h3>Messages</h3>
        <table>
            <thead>
              <th>From</th>
              <th>Subject</th>
              <th>Received</th>
            </thead>
            {% for message in messages %}
            <tr>
              <td>{{ message.from_user.username }}</td>
              {% if message.read == True %}
              <td><a href="{% url 'message_detail_view' pk=message.id %}" style="font-style:italic;">{{ message.subject }}</a></td>
              {% else %}
              <td><a href="{% url 'message_detail_view' pk=message.id %}" style="font-weight:900;">{{ message.subject }} (new)</a></td>
              {% endif %}
              <td>{{ message.sent_date }}</td>
            </tr>
          {% endfor %}
          </table>
          <a href="{% url 'inbox_view' %}">see all</a>
        {% endif %}

        <div id="tabs">
            <a class="tab active" id="tab-0">Games you're borrowing</a>
            <a class="tab" id="tab-1">Games you're lending</a>
            <a class="tab" id="tab-2">Borrow requests on your games</a>
            <a class="tab" id="tab-3">Borrow requests you've made</a>
            <a class="tab" id="tab-4">Request history (your games)</a>
            <div class="tab-content active" id="tab-content-0">
              <ul>
                {% for game in borrowing_games %}
                <li>
                  {{ game.game.title }} (borrowed {{ game.checked_out_date }})
                </li>
                {% endfor %}
              </ul>
            </div>
            <div class="tab-content" id="tab-content-1">
              <ul>
                  {% for game in lending_games %}
                  <li>{{ game.game.title }} (lending to {{ game.checked_out_user }} since {{game.checked_out_date}})</li>
                  <form method="POST" action="{% url 'mark_as_returned_view' %}">
                    {% csrf_token %}
                    <input type="hidden" value="{{ game.id }}" name="game_id">
                    <input type="submit" value="Mark as returned">
                  </form>
                  {% endfor %}
                </ul>
            </div>
            <div class="tab-content" id="tab-content-2"><ul>
                {% for request in incoming_borrow_requests %}
                <li>
                  {{ request.game.game.title }} (requested by {{ request.borrower }})
                  <form method="POST" action="{% url 'accept_request_view' %}">
                    {% csrf_token %}
                    <input type="hidden" value="{{ request.id }}" name="request">
                    <input type="submit" value="Accept Request">
                  </form>
                  <form method="POST" action="{% url 'deny_request_view' %}">
                    {% csrf_token %}
                    <input type="hidden" value="{{ request.id }}" name="request">
                    <input type="submit" value="Deny Request">
                  </form>
                </li>
                {% endfor %}
              </ul>
            </div>
            <div class="tab-content" id="tab-content-3"><ul>
                {% for request in outgoing_borrow_requests %}
                <li>
                  {{ request.game.game.title }} (owned by {{ request.game.owner }})
                </li>
                {% endfor %}
              </ul>
            </div>
            <div class="tab-content" id="tab-content-4"><ul>
                {% for request in request_history %}
                <li>
                  {{ request.game.game.title }} - requested by {{ request.borrower }} on {{ request.game.checked_out_date }}
                  ({{ request.status }})
                </li>
                {% endfor %}
              </ul>
            </div>
        
        </div>
        <style type="text/css">
          * {
              box-sizing: border-box;
          }
          #tabs {
              position: relative;
              display: block;
              width: 100%;
              max-width: 600px;
          }
          .tab {
              display: inline-block;
              background: blue;
              width: 25%;
              float: left;
              border-right: 1px solid #fff;
              text-align: center;
              padding: 10px;
              cursor: pointer;
          }
          .tab.active {
              background: green;
          }
          .tab-content {
              clear: both;
              position: relative;
              display: none;
              width: 100%;
              padding: 20px;
              background: red;
          }
          .tab-content.active {
              display: block;
          }
      </style>
        <!-- <h3>Games you're borrowing</h3>
        <h3><a href="{% url 'send_message_view' %}">Send new message</a></h3>
        <h3>Games you're borrowing</h3>
        <ul>
          {% for game in borrowing_games %}
          <li>
            {{ game.game.title }} (borrowed {{ game.checked_out_date }})
          </li>
          {% endfor %}
        </ul>

        <h3>Games you're lending</h3>
        <ul>
          {% for game in lending_games %}
          <li>{{ game.game.title }} (lending to {{ game.checked_out_user }} since {{game.checked_out_date}})</li>
          <form method="POST" action="{% url 'mark_as_returned_view' %}">
            {% csrf_token %}
            <input type="hidden" value="{{ game.id }}" name="game_id">
            <input type="submit" value="Mark as returned">
          </form>
          {% endfor %}
        </ul>

        <h3>Borrow requests on your games</h3>

        <ul>
          {% for request in incoming_borrow_requests %}
          <li>
            {{ request.game.game.title }} (requested by {{ request.borrower }})
            <form method="POST" action="{% url 'accept_request_view' %}">
              {% csrf_token %}
              <input type="hidden" value="{{ request.id }}" name="request">
              <input type="submit" value="Accept Request">
            </form>
            <form method="POST" action="{% url 'deny_request_view' %}">
              {% csrf_token %}
              <input type="hidden" value="{{ request.id }}" name="request">
              <input type="submit" value="Deny Request">
            </form>
          </li>
          {% endfor %}
        </ul>

        <h3>Borrow requests you've made</h3>

        <ul>
          {% for request in outgoing_borrow_requests %}
          <li>
            {{ request.game.game.title }} (owned by {{ request.game.owner }})
          </li>
          {% endfor %}
        </ul>

        <h3>Request history (your games)</h3>

        <ul>
          {% for request in request_history %}
          <li>
            {{ request.game.game.title }} - requested by {{ request.borrower }} on {{ request.game.checked_out_date }}
            ({{ request.status }})
          </li>
          {% endfor %}
        </ul> -->
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
    var current = 0;
    var tabs = document.getElementsByClassName('tab');
    for(var i=0; i<tabs.length; i++) {
        var tab = tabs[i];
        tab.addEventListener('click', function() {
            var activeTab = document.getElementById('tab-'+current).classList.remove('active');
            var activeContent = document.getElementById('tab-content-'+current).classList.remove('active');
            
            current = parseInt(this.id.replace(/\D/g,''));
            
            activeTab = document.getElementById('tab-'+current).classList.add('active');
            activeContent = document.getElementById('tab-content-'+current).classList.add('active');
        });
    }
</script>
{% endblock content %}
